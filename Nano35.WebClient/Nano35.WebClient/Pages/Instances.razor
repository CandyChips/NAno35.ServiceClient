@using Microsoft.AspNetCore.Authorization
@using Nano35.HttpContext.instance
@attribute [Authorize]
@page "/instances"

<AuthorizeView>
    @if (_loading)
    {
        <div class="col-md-6 offset-md-3 mt-5">
            <div class="card">
                <h4 class="card-header">Загрузка</h4>
                <div class="card-body">
                    ...
                </div>
            </div>
        </div>
    }
    else
    {
        @if (!_serverAvailable)
        {
            <h4 class="card-header">Сервер недоступен</h4>
            <div class="card-body">
                Повторите попытку позднее
            </div>
        }
        else
        {
            <RadzenButton Click=@(args => { _isNewInstanceDisplay = true; }) 
                          Text="Создать"
                          ButtonStyle="ButtonStyle.Secondary"
                          Style="width: 100%" />
            
            <Modal Title="Новая организация" 
                   IsDisplay="@_isNewInstanceDisplay">
                <Form>
                    <CreateInstance/>  
                </Form>
            </Modal>
        
            <RadzenGrid Data="@_data"
                        EmptyText="..."
                        TItem="InstanceViewModel">
                <Columns>
                    <RadzenGridColumn TItem="InstanceViewModel"
                                      Property="OrgName" 
                                      Title="Название" />
                    <RadzenGridColumn TItem="InstanceViewModel" 
                                      Property="OrgRealName" 
                                      Title="Организация" />
                    <RadzenGridColumn TItem="InstanceViewModel"
                                      Context="order"
                                      Bubble="false"
                                      TextAlign="TextAlign.Center" 
                                      Width="70px">
                        <Template Context="item">
                            <RadzenButton
                                ButtonStyle="ButtonStyle.Danger"
                                Icon="close"
                                Size="ButtonSize.Small" 
                                Click="@(args => { OpenOrg(item.Id); })">
                            </RadzenButton>
                        </Template>
                    </RadzenGridColumn>
                </Columns>
            </RadzenGrid>
        }
    }
</AuthorizeView>