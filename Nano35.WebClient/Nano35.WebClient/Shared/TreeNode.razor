@using Nano35.WebClient.Services
@using Nano35.Contexts.Http.storage
@inject HttpGet GetRequest
@inject RequestManager RequestManager
@inject ISessionProvider SessionProvider

@if (_childs.Count != 0)
{
    <RadzenTreeItem Text="@Item.Name">
        @foreach (var item in _childs)
        {
            <TreeNode Item="@item"/>
        }
    </RadzenTreeItem>
}
else
{
    <RadzenTreeItem Text="@Item.Name" />
}

@code
{
    [Parameter] public ArticleCategoryViewModel Item { get; set; }
    private List<ArticleCategoryViewModel> _childs = new();

    protected override async Task OnInitializedAsync()
    {
        await GetRequest.InvokeAsync<GetAllArticleCategoriesSuccessHttpResponse>($"Category?InstanceId={await SessionProvider.GetCurrentInstanceId()}&ParentId={Item.Id}",
            resp =>
            {
                if (resp.IsSuccess())
                {
                    _childs = resp.Success.Data;
                }
            });
    }
}
