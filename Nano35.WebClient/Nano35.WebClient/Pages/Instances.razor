@using Microsoft.AspNetCore.Authorization
@using Nano35.HttpContext.instance
@attribute [Authorize]
@page "/instances"

<AuthorizeView>
    @if (_loading)
    {
        <div class="col-md-6 offset-md-3 mt-5">
            <div class="card">
                <h4 class="card-header">Загрузка</h4>
                <div class="card-body">
                    ...
                </div>
            </div>
        </div>
    }
    else
    {
        @if (!_serverAvailable)
        {
            <h4 class="card-header">Сервер недоступен</h4>
            <div class="card-body">
                Повторите попытку позднее
            </div>
        }
        else
        {
            <RadzenHeading Text="Организации"/>
    
            <RadzenButton Click=@(_ => OpenNewInstance()) 
                          Text="Создать"
                          Style="margin: 1rem 0;"
                          ButtonStyle="ButtonStyle.Secondary"/>

            <RadzenGrid Data=@(_data)
                        EmptyText="..."
                        TItem="InstanceViewModel">
                <Columns>
                    <RadzenGridColumn TItem="InstanceViewModel"
                                      Property="OrgName" 
                                      Title="Название" />
                    <RadzenGridColumn TItem="InstanceViewModel" 
                                      Property="OrgRealName" 
                                      Title="Организация" />
                    <RadzenGridColumn TItem="InstanceViewModel"
                                      Context="order"
                                      Bubble="false"
                                      TextAlign="TextAlign.Center" 
                                      Width="70px">
                        <Template Context="item">
                            <RadzenButton
                                ButtonStyle="ButtonStyle.Danger"
                                Icon="close"
                                Size="ButtonSize.Small" 
                                Click="@(_ => OpenOrg(item.Id))">
                            </RadzenButton>
                        </Template>
                    </RadzenGridColumn>
                </Columns>
            </RadzenGrid>
        }
    }
</AuthorizeView>