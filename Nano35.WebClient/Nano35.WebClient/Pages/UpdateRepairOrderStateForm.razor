@using Nano35.WebClient.Services
@using Nano35.HttpContext.storage
@inject HttpClient HttpClient
@inject IRequestManager RequestManager
@inject ISessionProvider SessionProvider

<EditForm OnSubmit="HandleValidSubmit">
    @if (_isLoaded)
    {
        <DataAnnotationsValidator/>
        
        <InputField Title="Товар">
            <Controls>
                <RadzenDropDown Data=@(StateTypes.Select(a => new {Id = a.Item1, Name = a.Item2}))
                                TextProperty="Name"
                                ValueProperty="Id"
                                TValue="Guid"
                                @bind-Value="_model.TypeId"
                                Style="width: 100%;"
                                Placeholder="..."
                                FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                                FilterOperator="StringFilterOperator.Contains"
                                AllowFiltering="true"/>
            </Controls>
        </InputField>
        
        <InputField Title="комментарий">
            <Controls>
                <RadzenTextBox Style="width: 100%;" 
                               Placeholder="..."
                               @bind-Value="comment"/>
            </Controls>
        </InputField>

        <RadzenButton type="submit"
                      Text="Создать"
                      ButtonStyle="ButtonStyle.Primary"
                      Style="width: 100%" />
    }
</EditForm>

@code
{
    [CascadingParameter]
    BlazoredModalInstance ModalInstance { get; set; }

    private bool _isLoaded;
    private string comment;
    private UpdateRepairOrderStateForm _model = new UpdateRepairOrderStateForm();

    private List<Tuple<int,string>> StateTypes { get; set; }
    protected override async Task OnInitializedAsync()
    {
        StateTypes.Add(new Tuple<int, string>(0, "Новый"));
        StateTypes.Add(new Tuple<int, string>(1, "В работе"));
        StateTypes.Add(new Tuple<int, string>(2, "Завершен"));
        StateTypes.Add(new Tuple<int, string>(3, "Приостановлен"));
        StateTypes.Add(new Tuple<int, string>(4, "Ожиждает запчасти"));
        _isLoaded = true;
    }

    private void HandleValidSubmit()
    {
        ModalInstance.CloseAsync();
    }

}