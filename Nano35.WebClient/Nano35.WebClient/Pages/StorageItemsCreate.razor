@using Nano35.HttpContext.storage
@using Nano35.WebClient.Services
@inject IRequestManager RequestManager
@inject ISessionProvider SessionProvider 
@inject HttpClient HttpClient 

<StorageItemsForm FormSubmitted="Submit"
                 Model="_model" 
                 Error="@Error"/>

@code
{
    private CreateStorageItemHttpBody _model = new CreateStorageItemHttpBody();
    private string Error { get; set; } = "";
    
    private async Task Submit()
    {
        try
        {
            await new CreateStorageItemRequest(RequestManager, HttpClient, _model).Send();
        }
        catch (Exception e)
        {
            Error = e.Message;
        }
    }
    
    protected override async Task OnInitializedAsync()
    {
        _model = new CreateStorageItemHttpBody
        {
            InstanceId = await SessionProvider.GetCurrentInstanceId(),
            NewId = Guid.NewGuid()
        };
    }
}
