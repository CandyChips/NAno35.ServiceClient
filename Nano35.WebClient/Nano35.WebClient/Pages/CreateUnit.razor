@using Nano35.WebClient.Services
@using Nano35.HttpContext.instance
@inject HttpClient HttpClient
@inject IRequestManager RequestManager
@inject ISessionProvider SessionProvider

<UnitForm FormSubmitted="Submit"
          Model="_model" 
          Error="@Error"/>

@code
{
    private CreateUnitHttpBody _model = new CreateUnitHttpBody
    {
        Id = Guid.NewGuid(),
        InstanceId = Guid.Empty
    };
    private string Error { get; set; }
    
    private async Task Submit()
    {
        try
        {
            Console.WriteLine("sss");
            await new CreateUnitRequest(RequestManager, HttpClient, _model).Send();
        }
        catch (Exception e)
        {
            Error = e.Message;
        }
    }
    
    protected override async Task OnInitializedAsync()
    {
        _model = new CreateUnitHttpBody
        {
            Id = Guid.NewGuid(),
            InstanceId = await SessionProvider.GetCurrentInstanceId()
        };
    }
}
