@using Nano35.WebClient.Services
@using Nano35.HttpContext.instance
@inject IRequestManager RequestManager
@inject ISessionProvider SessionProvider
@inject NavigationManager NavigationManager
@inject HttpPost PostRequest


<BoxedContent Width="40">
    <UnitsForm FormSubmitted="OnSubmit" Model="@_model" Error="@Error"/>
</BoxedContent>

@code
{
    private CreateUnitHttpBody _model = new();
    private string Error { get; set; }
    
    protected override async Task OnInitializedAsync()
    {
        _model = new CreateUnitHttpBody
        {
            Id = Guid.NewGuid(),
            InstanceId = await SessionProvider.GetCurrentInstanceId()
        };
    }
    
    private async Task OnSubmit()
    {
        try
        {
            await PostRequest.InvokeAsync<CreateUnitHttpResponse, CreateUnitHttpBody>(
                RequestManager.InstanceServer, $"Units", _model,
                resp =>
                {
                    if (resp.IsSuccess()) {}
                    else
                    {
                        Console.WriteLine(resp.Error);
                        NavigationManager.NavigateTo("/instance-view");
                    }
                });
        }
        catch (Exception e)
        {
            Error = e.Message;
        }
    }
}
