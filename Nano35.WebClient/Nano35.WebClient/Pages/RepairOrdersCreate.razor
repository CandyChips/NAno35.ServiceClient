@using Nano35.WebClient.Services
@using Nano35.HttpContext.Repair
@inject HttpClient HttpClient
@inject IRequestManager RequestManager
@inject ISessionProvider SessionProvider

<BoxedContent Width="40">
    <RepairOrdersForm FormSubmitted="SendCreateRepairOrderRequest" Model="_model" Error="@Error"/>
</BoxedContent>

@code
{
    private CreateRepairOrderHttpBody _model = new()
    {
        NewId = Guid.NewGuid(),
        InstanceId = Guid.Empty
    };
    
    private string Error { get; set; }
    private async Task SendCreateRepairOrderRequest()
    {
        try
        {
            await new HttpPostRequest<CreateRepairOrderHttpBody,CreateRepairOrderHttpResponse>(HttpClient, $"{RequestManager.RepairOrdersServer}/RepairOrders").PostAsync(_model);
        }
        catch (Exception e)
        {
            Error = e.Message;
        }
    }
    
    protected override async Task OnInitializedAsync()
    {
        _model = new CreateRepairOrderHttpBody
        {
            NewId = Guid.NewGuid(),
            InstanceId = await SessionProvider.GetCurrentInstanceId(),
           
        };
    }
}